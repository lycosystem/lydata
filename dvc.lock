schema: '2.0'
stages:
  lyproxify@1:
    cmd: "lyscripts data lyproxify -i 2023-clb-multisite/raw.csv -o 2023-clb-multisite/data.csv
      -m 2023-clb-multisite/mapping.py -r 0 1 2 --drop-rows 439 --add-index\n"
    deps:
    - path: 2023-clb-multisite/mapping.py
      hash: md5
      md5: c6288835d865c1eab11edcd678387098
      size: 28320
    - path: 2023-clb-multisite/raw.csv
      hash: md5
      md5: 07fb62f160142252fe11e1738de6331f
      size: 211635
    outs:
    - path: 2023-clb-multisite/data.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
  description-and-docs@2023-clb-multisite:
    cmd: "python scripts/render.py -m 2023-clb-multisite/mapping.py -d 2023-clb-multisite/data.csv
      -t 2023-clb-multisite/README.template -o 2023-clb-multisite/README.md\n"
    deps:
    - path: 2023-clb-multisite/README.template
      hash: md5
      md5: c54e16da349dbdc1223f6bb9d76bccb8
      size: 3335
    - path: 2023-clb-multisite/data.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: 2023-clb-multisite/mapping.py
      hash: md5
      md5: c6288835d865c1eab11edcd678387098
      size: 28320
    - path: scripts/render.py
      hash: md5
      md5: 6d41cb47a8c326a558958693b08004f1
      size: 2005
    outs:
    - path: 2023-clb-multisite/README.md
      hash: md5
      md5: 4ba13c58d910e944ff85869cf18657b0
      size: 14652
  description-and-docs@2023-isb-multisite:
    cmd: "python scripts/render.py -m 2023-isb-multisite/mapping.py -d 2023-isb-multisite/data.csv
      -t 2023-isb-multisite/README.template -o 2023-isb-multisite/README.md\n"
    deps:
    - path: 2023-isb-multisite/README.template
      hash: md5
      md5: f1b18db234f07dec1b0af49bae29867d
      size: 3104
    - path: 2023-isb-multisite/data.csv
      hash: md5
      md5: 569984943168f3a56d6ca58d0813dee2
      size: 204323
    - path: 2023-isb-multisite/mapping.py
      hash: md5
      md5: b12195246e7d014b2afca09d6d057ed9
      size: 52919
    - path: scripts/render.py
      hash: md5
      md5: 6d41cb47a8c326a558958693b08004f1
      size: 2005
    outs:
    - path: 2023-isb-multisite/README.md
      hash: md5
      md5: e6ef82ce8587780bc50ee9150d4e0e71
      size: 19600
  lyproxify@0:
    cmd: "lyscripts data lyproxify -i 2021-clb-oropharynx/raw.csv -o 2021-clb-oropharynx/data.csv
      -m 2021-clb-oropharynx/mapping.py -r 0\n"
    deps:
    - path: 2021-clb-oropharynx/mapping.py
      hash: md5
      md5: 9af923f8347ab62eaf5eb29d7708f52e
      size: 21377
    - path: 2021-clb-oropharynx/raw.csv
      hash: md5
      md5: ca6413b63f277e4f6bb40b50294b0ff0
      size: 96789
    outs:
    - path: 2021-clb-oropharynx/data.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
  lyproxify@2:
    cmd: "lyscripts data lyproxify -i 2023-isb-multisite/raw.csv -o 2023-isb-multisite/data.csv
      -m 2023-isb-multisite/mapping.py -r 0\n"
    deps:
    - path: 2023-isb-multisite/mapping.py
      hash: md5
      md5: b12195246e7d014b2afca09d6d057ed9
      size: 52919
    - path: 2023-isb-multisite/raw.csv
      hash: md5
      md5: e9130a2d45977f28ca0f7a26f38bf26b
      size: 167141
    outs:
    - path: 2023-isb-multisite/data.csv
      hash: md5
      md5: 569984943168f3a56d6ca58d0813dee2
      size: 204323
  description-and-docs@2021-clb-oropharynx:
    cmd: "python scripts/render.py -m 2021-clb-oropharynx/mapping.py -d 2021-clb-oropharynx/data.csv
      -t 2021-clb-oropharynx/README.template -o 2021-clb-oropharynx/README.md\n"
    deps:
    - path: 2021-clb-oropharynx/README.template
      hash: md5
      md5: 34d1d3ab6d8bb41cec305888d8d680c9
      size: 16718
    - path: 2021-clb-oropharynx/data.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: 2021-clb-oropharynx/mapping.py
      hash: md5
      md5: 9af923f8347ab62eaf5eb29d7708f52e
      size: 21377
    - path: scripts/render.py
      hash: md5
      md5: 6d41cb47a8c326a558958693b08004f1
      size: 2005
    outs:
    - path: 2021-clb-oropharynx/README.md
      hash: md5
      md5: 66c662420c021bd9cc1673ea7cfcf081
      size: 25515
  convert-to-docx@2021-clb-oropharynx:
    cmd: "pandoc -o ../2021-clb-oropharynx.docx 2021-clb-oropharynx/README.md\n"
    deps:
    - path: 2021-clb-oropharynx/README.md
      md5: f0ec7b542820fc363b43aa635bfe430c
      size: 24247
    outs:
    - path: ../2021-clb-oropharynx.docx
      md5: 786537c15c333face3f493a98bfffb03
      size: 18743
  convert-to-docx@2023-clb-multisite:
    cmd: "pandoc -o ../2023-clb-multisite.docx 2023-clb-multisite/README.md\n"
    deps:
    - path: 2023-clb-multisite/README.md
      md5: 49ee462171066d1863ed7801054203d7
      size: 13045
    outs:
    - path: ../2023-clb-multisite.docx
      md5: dc1a259586b55abbacb317f04f53dc95
      size: 15819
  convert-to-docx@2023-isb-multisite:
    cmd: "pandoc -o ../2023-isb-multisite.docx 2023-isb-multisite/README.md\n"
    deps:
    - path: 2023-isb-multisite/README.md
      md5: 94299a49ee0cad7483e05ad73a433477
      size: 16776
    outs:
    - path: ../2023-isb-multisite.docx
      md5: f7ecf6740c106fcd109e6dfe71ab971d
      size: 16747
  plot-age-and-sex@2023-clb-multisite:
    cmd: "python scripts/age_and_sex.py 2023-clb-multisite/data.csv\n"
    deps:
    - path: 2023-clb-multisite/data.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: scripts/age_and_sex.py
      hash: md5
      md5: acd161580d93b39eda4c46e5fb54a79d
      size: 3214
  plot-t-category@2023-clb-multisite:
    cmd: "python scripts/t_category.py 2023-clb-multisite/data.csv\n"
    deps:
    - path: 2023-clb-multisite/data.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: scripts/t_category.py
      hash: md5
      md5: 525ea786589ede53c4b9bb7e5f9d8d42
      size: 1648
  plot-t-category@2023-isb-multisite:
    cmd: "python scripts/t_category.py 2023-isb-multisite/data.csv\n"
    deps:
    - path: 2023-isb-multisite/data.csv
      hash: md5
      md5: 569984943168f3a56d6ca58d0813dee2
      size: 204323
    - path: scripts/t_category.py
      hash: md5
      md5: 525ea786589ede53c4b9bb7e5f9d8d42
      size: 1648
  plot-age-and-sex@2021-clb-oropharynx:
    cmd: "python scripts/age_and_sex.py 2021-clb-oropharynx/data.csv\n"
    deps:
    - path: 2021-clb-oropharynx/data.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: scripts/age_and_sex.py
      hash: md5
      md5: acd161580d93b39eda4c46e5fb54a79d
      size: 3214
  plot-age-and-sex@2023-isb-multisite:
    cmd: "python scripts/age_and_sex.py 2023-isb-multisite/data.csv\n"
    deps:
    - path: 2023-isb-multisite/data.csv
      hash: md5
      md5: 569984943168f3a56d6ca58d0813dee2
      size: 204323
    - path: scripts/age_and_sex.py
      hash: md5
      md5: acd161580d93b39eda4c46e5fb54a79d
      size: 3214
  plot-t-category@2021-clb-oropharynx:
    cmd: "python scripts/t_category.py 2021-clb-oropharynx/data.csv\n"
    deps:
    - path: 2021-clb-oropharynx/data.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: scripts/t_category.py
      hash: md5
      md5: 525ea786589ede53c4b9bb7e5f9d8d42
      size: 1648
  plot-t-category@2021-usz-oropharynx:
    cmd: "python scripts/t_category.py 2021-usz-oropharynx/data.csv\n"
    deps:
    - path: 2021-usz-oropharynx/data.csv
      hash: md5
      md5: 493a8161e4290d6c358ab117b57e1260
      size: 166961
    - path: scripts/t_category.py
      hash: md5
      md5: 525ea786589ede53c4b9bb7e5f9d8d42
      size: 1648
  plot-age-and-sex@2021-usz-oropharynx:
    cmd: "python scripts/age_and_sex.py 2021-usz-oropharynx/data.csv\n"
    deps:
    - path: 2021-usz-oropharynx/data.csv
      hash: md5
      md5: 493a8161e4290d6c358ab117b57e1260
      size: 166961
    - path: scripts/age_and_sex.py
      hash: md5
      md5: acd161580d93b39eda4c46e5fb54a79d
      size: 3214
  plot-subsite@2021-usz-oropharynx:
    cmd: "python scripts/subsite.py --data 2021-usz-oropharynx/data.csv\n"
    deps:
    - path: 2021-usz-oropharynx/data.csv
      hash: md5
      md5: 493a8161e4290d6c358ab117b57e1260
      size: 166961
    - path: scripts/subsite.py
      hash: md5
      md5: 3bc7a351a634211ca9f8382b7d71bd96
      size: 4704
  plot-subsite@2021-clb-oropharynx:
    cmd: "python scripts/subsite.py --data 2021-clb-oropharynx/data.csv\n"
    deps:
    - path: 2021-clb-oropharynx/data.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: scripts/subsite.py
      hash: md5
      md5: 3bc7a351a634211ca9f8382b7d71bd96
      size: 4704
  plot-subsite@2023-isb-multisite:
    cmd: "python scripts/subsite.py --data 2023-isb-multisite/data.csv\n"
    deps:
    - path: 2023-isb-multisite/data.csv
      hash: md5
      md5: 569984943168f3a56d6ca58d0813dee2
      size: 204323
    - path: scripts/subsite.py
      hash: md5
      md5: 3bc7a351a634211ca9f8382b7d71bd96
      size: 4704
  plot-subsite@2023-clb-multisite:
    cmd: "python scripts/subsite.py --data 2023-clb-multisite/data.csv\n"
    deps:
    - path: 2023-clb-multisite/data.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: scripts/subsite.py
      hash: md5
      md5: 3bc7a351a634211ca9f8382b7d71bd96
      size: 4704
  bar-plot@2021-clb-oropharynx:
    cmd: python scripts/bar_plot.py 2021-clb-oropharynx/data.csv
    deps:
    - path: 2021-clb-oropharynx/data.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: scripts/bar_plot.py
      hash: md5
      md5: 65c6304694688261ce7cf1de97b18b47
      size: 2627
  bar-plot@2023-clb-multisite:
    cmd: python scripts/bar_plot.py 2023-clb-multisite/data.csv
    deps:
    - path: 2023-clb-multisite/data.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: scripts/bar_plot.py
      hash: md5
      md5: 65c6304694688261ce7cf1de97b18b47
      size: 2627
  bar-plot@2023-isb-multisite:
    cmd: python scripts/bar_plot.py 2023-isb-multisite/data.csv
    deps:
    - path: 2023-isb-multisite/data.csv
      hash: md5
      md5: 569984943168f3a56d6ca58d0813dee2
      size: 204323
    - path: scripts/bar_plot.py
      hash: md5
      md5: 65c6304694688261ce7cf1de97b18b47
      size: 2627
  join:
    cmd: "lyscripts data join --inputs 2021-clb-oropharynx/data.csv 2023-isb-multisite/data.csv
      2023-clb-multisite/data.csv --output joined.csv\n"
    deps:
    - path: 2021-clb-oropharynx/data.csv
      hash: md5
      md5: d40c0a1ae967a6983d60a0a809cf3972
      size: 92742
    - path: 2023-clb-multisite/data.csv
      hash: md5
      md5: 9d72ee96af2c51033a2fb0bb8551e318
      size: 123938
    - path: 2023-isb-multisite/data.csv
      hash: md5
      md5: 569984943168f3a56d6ca58d0813dee2
      size: 204323
    outs:
    - path: joined.csv
      hash: md5
      md5: 579ef5dc5979a01536cd19c146bc8f6e
      size: 520213
  enhance:
    cmd: "lyscripts data enhance --consensus max_llh --params modalities.yaml joined.csv
      enhanced.csv\n"
    deps:
    - path: joined.csv
      hash: md5
      md5: 579ef5dc5979a01536cd19c146bc8f6e
      size: 520213
    params:
      modalities.yaml:
        modalities:
          CT:
          - 0.76
          - 0.81
          MRI:
          - 0.63
          - 0.81
          PET:
          - 0.86
          - 0.79
          FNA:
          - 0.98
          - 0.8
          diagnostic_consensus:
          - 0.86
          - 0.81
          pathology:
          - 1.0
          - 1.0
          pCT:
          - 0.86
          - 0.81
          max_llh:
          - 1.0
          - 1.0
    outs:
    - path: enhanced.csv
      hash: md5
      md5: eba7b0ecbd72d293378bf8952335c86b
      size: 644105
  scenario-showcase:
    cmd: "python scripts/scenario_showcase.py --data enhanced.csv --mplstyle scripts/.mplstyle\n"
    deps:
    - path: enhanced.csv
      hash: md5
      md5: eba7b0ecbd72d293378bf8952335c86b
      size: 644105
    - path: scripts/.mplstyle
      hash: md5
      md5: 1dd8e65e1d2705d5c02ec977b8e7ca0d
      size: 2151
    - path: scripts/scenario_showcase.py
      hash: md5
      md5: 0f9bfd6d539308d71ff468e861977dae
      size: 5106
    outs:
    - path: scenario_showcase.png
      hash: md5
      md5: 2ce86261eac36207428e832fc452cadb
      size: 86913
  remove-spaces:
    cmd: "sed 's/,\\s,/,,/' 2023-hvh-oropharynx/raw.csv > 2023-hvh-oropharynx/data.csv\n"
    deps:
    - path: 2023-hvh-oropharynx/raw.csv
      hash: md5
      md5: 112174280f4e4fad71256b68a1882ed5
      size: 83202
    outs:
    - path: 2023-hvh-oropharynx/data.csv
      hash: md5
      md5: fd903ddebc5380e7fabdd117aa4d8b8b
      size: 83190
  format-dates-insert-institution-and-remove-spaces:
    cmd: sed 's/\([0-9]\{2\}\)\/\([0-9]\{2\}\)\/\([0-9]\{4\}\)/\3-\2-\1/g' 2023-hvh-oropharynx/raw.csv
      | sed 's/,dataset,/,institution,/g' | sed "s/,2023_HVH_OROPHARYNX,/,Vall d'Hebron
      Hospital Barcelona,/g" | sed 's/,\s,/,,/g' > 2023-hvh-oropharynx/data.csv
    deps:
    - path: 2023-hvh-oropharynx/raw.csv
      hash: md5
      md5: 86078d185c55fa16b066db4917306425
      size: 81066
    outs:
    - path: 2023-hvh-oropharynx/data.csv
      hash: md5
      md5: b241f628c91881867872c3dd2e1e1c30
      size: 83185
